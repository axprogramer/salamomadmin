import{r,i as E,k as o,o as g,j as e,s as de,m as L,n as ie}from"./index-BOW9aXAt.js";import"./firebaseConfig-C2RYo4BK.js";import{S as N}from"./sweetalert2.all-CknvBjmT.js";import{C as k}from"./index.es-BNppl9rn.js";import{c as me}from"./cil-plus-D8mtC-W5.js";import{C as he,a as be,b as T,c as w,d as pe}from"./CTable-R-4nV3n8.js";import{C as A}from"./CButton-DTyOUR8Q.js";import{c as xe,a as je}from"./cil-trash-BwZseM3u.js";import{c as fe}from"./cil-pen-53d2I-C-.js";import{c as ye}from"./cil-search-CDkY_4k-.js";const Ie=()=>{const[O,R]=r.useState([]),[q,D]=r.useState([]),[H,P]=r.useState([]),[U,K]=r.useState([]),[$,Y]=r.useState([]),[F,V]=r.useState([]),[z,W]=r.useState([]),h=r.useRef(null),b=r.useRef(null),d=r.useRef(null),p=r.useRef(null),x=r.useRef(null),j=r.useRef(null),[i,y]=r.useState(""),_=r.useRef(""),C=r.useRef(""),M=r.useRef(""),m=E(),X=o(m,"SalaMOM/staffs"),G=o(m,"/SalaMOM/users/"),J=o(m,"/SalaMOM/tools/years/"),Q=o(m,"/SalaMOM/tools/subjects/"),Z=o(m,"/SalaMOM/tools/class/បឋមសិក្សា"),ee=o(m,"/SalaMOM/tools/class/អនុវិទ្យាល័យ"),te=o(m,"/SalaMOM/tools/class/វិទ្យាល័យ");r.useEffect(()=>{g(X,t=>{const s=t.val();R(s?Object.values(s):[])}),g(G,t=>{const s=t.val();D(s?Object.values(s):[])}),g(J,t=>{const s=t.val();P(s?Object.values(s):[])}),g(Z,t=>{const s=t.val();K(s?Object.values(s):[])}),g(ee,t=>{const s=t.val();Y(s?Object.values(s):[])}),g(te,t=>{const s=t.val();V(s?Object.values(s):[])}),g(Q,t=>{const s=t.val();W(s?Object.values(s):[])}),_.current.style.display="none"},[]);const se=t=>t.get_url_pic?e.jsx("img",{className:"me-3",style:{width:"50px"},src:t.get_url_pic,alt:"image"}):e.jsx("img",{className:"me-3",style:{width:"50px"},src:"https://res.cloudinary.com/salamomschool/image/upload/v1709357129/fab63d7f9d9dd9de94019d884eac4a25.png",alt:"image"});setTimeout(()=>{const t=document.querySelector(".dropdown-content"),s=document.getElementById("user_teacher_id"),u=document.getElementById("user_url");t.addEventListener("click",a=>{if(a.target.tagName==="LI"){const v=a.target.dataset.label,S=a.target.dataset.image;s.value=v,u.value=S,y(v),d.current.value=S,t.classList.remove("show")}}),document.querySelectorAll('#selection input[type="checkbox"][id^="grade"]'),document.querySelectorAll('#selection input[type="checkbox"][id^="subject"]');const f=document.getElementById("add"),l=document.getElementById("selectedSubjects3");document.getElementById("getInput");function c(){let a=[];const v=document.querySelectorAll('input[id^="grade"]');for(const n of v)n.checked&&a.push(n.value);const S=document.querySelectorAll('input[id^="subject"]');for(const n of S)n.checked&&a.push(n.value);const B=a.pop(),I=a.filter(n=>n!==B).map(n=>`${n}-${B}`).join(" ");l.value=l.value?`${l.value} ${I}`:`${l.value} ${I}`,v.forEach(n=>n.checked=!1),S.forEach(n=>n.checked=!1)}f.addEventListener("click",c)},500);const re=t=>{const s=t.currentTarget.dataset.staffid,u=t.currentTarget.dataset.fullname,f=t.currentTarget.dataset.password,l=t.currentTarget.dataset.pictureurl,c=t.currentTarget.dataset.role,a=t.currentTarget.dataset.subs,v=t.currentTarget.dataset.teacheryear;h.current.value=u,b.current.value=f,d.current.value=l,p.current.value=c,x.current.value=a,j.current.value=v,y(s),C.current.style.display="none",_.current.style.display="inline-block",M.current.style.display="inline-block"},ae=()=>{C.current.style.display="inline-block",_.current.style.display="none",M.current.style.display="none",h.current.value=null,d.current.value=null,p.current.value=null,x.current.value=null,j.current.value=null,y(""),setTimeout(()=>{function t(){const u="0123456789",f="ABCDEFGHIJKLMNOPQRSTUVWXYZ",l=f.toLowerCase();let c="";for(let a=0;a<3;a++)c+=u[Math.floor(Math.random()*u.length)];for(let a=0;a<2;a++)c+=l[Math.floor(Math.random()*f.length)];return c=c.split("").sort(()=>Math.random()-.5).join(""),c}const s=t();b.current.value=s},500)},le=()=>{const t=E();i?(N.fire({text:"ព័ត៍មានបានបញ្ចូលត្រឹមត្រូវ!",icon:"success",showConfirmButton:!1,timer:2200}),de(o(t,"/SalaMOM/users/"+i),{id:i,user_username:h.current.value,user_password:b.current.value,user_url:d.current.value,user_role:p.current.value,user_subs:x.current.value,user_teacher_year:j.current.value}),h.current.value=null,b.current.value=null,d.current.value=null,p.current.value=null,x.current.value=null,j.current.value=null,y("")):N.fire({text:"ព័ត៍មានមិនត្រឹមត្រូវ!",icon:"error",showConfirmButton:!1,timer:2200})},ne=()=>{const t=E();i?(N.fire({text:"ព័ត៍មានបានកែត្រឹមត្រូវ!",icon:"success",showConfirmButton:!1,timer:2200}),L(o(t,"/SalaMOM/users/"+i),{id:i,user_username:h.current.value,user_password:b.current.value,user_url:d.current.value,user_role:p.current.value,user_subs:x.current.value,user_teacher_year:j.current.value}),h.current.value=null,b.current.value=null,d.current.value=null,p.current.value=null,x.current.value=null,j.current.value=null,y("")):N.fire({text:"ព័ត៍មានមិនត្រឹមត្រូវ!",icon:"error",showConfirmButton:!1,timer:2200})},ce=t=>{i?(N.fire({text:"បានលុបត្រឹមត្រូវ",icon:"success",showConfirmButton:!1,timer:2200}),ie(o(m,"/SalaMOM/users/"+i)),h.current.value=null,b.current.value=null,d.current.value=null,p.current.value=null,x.current.value=null,j.current.value=null,y(""),C.current.style.display="inline-block",_.current.style.display="none",M.current.style.display="none"):N.fire({text:"ព័ត៍មានមិនត្រឹមត្រូវ!",icon:"error",showConfirmButton:!1,timer:2200})},oe=()=>(setTimeout(()=>{const t=document.getElementById("searchInput"),s=document.querySelector("table tbody");t.addEventListener("input",()=>{const u=t.value.toLowerCase(),f=Array.from(s.querySelectorAll("tr")).filter(l=>Array.from(l.querySelectorAll("td")).some(c=>c.textContent.toLowerCase().includes(u)));for(const l of s.querySelectorAll("tr"))l.classList.add("hidden");for(const l of f)l.classList.remove("hidden")})},1500),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"input-group",style:{padding:"15px"},children:[e.jsx("div",{className:"input-group-prepend hover-cursor",id:"navbar-search-icon",children:e.jsx("span",{style:{height:"38px"},className:"input-group-text",id:"search",children:e.jsx(k,{icon:ye})})}),e.jsx("input",{type:"text",className:"form-control",id:"searchInput",placeholder:"ស្វែងរក","aria-label":"search","aria-describedby":"search"})]})})),ue=t=>{const s=t.target.dataset.id,u=t.target.innerHTML;s&&L(o(m,"/SalaMOM/users/"+s),{user_subs:u})};return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12 grid-margin",children:e.jsx("div",{className:"card card-primary card-outline",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"row",children:[e.jsx("h4",{className:"card-title",children:"បង្កើតគណនីបុគ្គលិក"}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsxs("button",{onClick:ae,"data-bs-toggle":"modal","data-bs-target":"#AddNewSub",style:{color:"white"},id:"btn_upload",type:"button",className:"btn btn-success btn-sm",children:[e.jsx(k,{icon:me})," បង្កើតថ្មី"]})}),e.jsx("div",{children:e.jsx(oe,{})})]})}),e.jsxs("div",{style:{overflowX:"auto",padding:"15px"},children:[e.jsxs(he,{className:"table table-bordered table-hover",children:[e.jsx(be,{children:e.jsxs(T,{className:"frezze",children:[e.jsx(w,{style:{backgroundColor:"rgb(23, 116, 153)",color:"white"},className:"border-dark text-center",children:"ល.រ"}),e.jsx(w,{style:{backgroundColor:"rgb(23, 116, 153)",color:"white"},className:"border-dark text-center",children:"ឈ្មោះបុគ្គលិក"}),e.jsx(w,{style:{backgroundColor:"rgb(23, 116, 153)",color:"white"},className:"border-dark text-center",children:"ឈ្មោះចូលប្រព័ន្ធ"}),e.jsx(w,{style:{backgroundColor:"rgb(23, 116, 153)",color:"white"},className:"border-dark text-center",children:"លេខសម្ងាត់"}),e.jsx(w,{style:{backgroundColor:"rgb(23, 116, 153)",color:"white"},className:"border-dark text-center",children:"សិទ្ធិប្រើប្រាស់ប្រព័ន្ធ"}),e.jsx(w,{style:{backgroundColor:"rgb(23, 116, 153)",color:"white"},className:"border-dark text-center",children:"មុខវិជ្ជាបង្រៀន"}),e.jsx(w,{style:{backgroundColor:"rgb(23, 116, 153)",color:"white"},className:"border-dark text-center",children:"ឆ្នាំសិក្សា"})]})}),e.jsx(pe,{className:"staff_account",children:q.map((t,s)=>e.jsxs(T,{children:[e.jsx("td",{className:"text-center",children:s+1}),e.jsxs("td",{className:"text-start",onClick:re,"data-bs-toggle":"modal","data-bs-target":"#AddNewSub","data-fullname":t.user_username,"data-password":t.user_password,"data-role":t.user_role,"data-subs":t.user_subs,"data-teacheryear":t.user_teacher_year,"data-pictureurl":t.user_url,"data-staffid":t.id,children:[e.jsx("img",{className:"me-2",style:{width:"40px"},src:t.user_url,alt:"image"}),t.id]}),e.jsx("td",{className:"text-center",children:t.user_username}),e.jsx("td",{className:"text-center",children:t.user_password}),e.jsx("td",{className:"text-center",children:t.user_role}),e.jsx("td",{className:"text-center","data-id":t.id,contentEditable:!0,suppressContentEditableWarning:!0,onBlur:ue,dangerouslySetInnerHTML:{__html:t.user_subs}}),e.jsx("td",{className:"text-center",children:t.user_teacher_year})]}))})]}),e.jsx("div",{className:"modal fade",id:"AddNewSub",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"dropdown dropup",children:[e.jsx("button",{className:"btn dropdown-toggle",type:"button",id:"dropdownMenuName","data-bs-toggle":"dropdown","aria-expanded":"false",children:"ឈ្មោះបុគ្គលិក"}),e.jsx("ul",{className:"dropdown-menu menu-lg-scroll dropdown-content","aria-labelledby":"dropdownMenuName",id:"select_username",children:O.map((t,s)=>e.jsxs("li",{class:"dropdown-item","data-label":t.id,"data-image":t.get_url_pic,children:[e.jsxs("span",{className:"me-3",children:[s+1,"."]}),se(t),t.id]}))})]}),e.jsxs("p",{children:[e.jsx("input",{className:"form-control",type:"text",value:i,onInput:t=>{y(t.target.value)},onkeyup:"this.value = this.value.toLowerCase()",name:"user[username]",id:"user_teacher_id"}),e.jsx("input",{className:"form-control",type:"hidden",ref:d,onkeyup:"this.value = this.value.toLowerCase()",name:"user[username]",id:"user_url"})]}),e.jsxs("p",{children:[e.jsx("label",{for:"user_teacher_id",children:"ឆ្នាំសិក្សា"}),e.jsxs("select",{ref:j,className:"form-control",style:{color:"black",lineHeight:"2"},id:"user_teacher_year",children:[e.jsx("option",{value:"",children:"ជ្រើសរើសឆ្នាំសិក្សា"}),H.map((t,s)=>e.jsx("option",{value:t.yearEn,children:t.yearKh}))]})]}),e.jsxs("p",{children:[e.jsx("label",{for:"user_name",children:"ឈ្មោះចូលប្រព័ន្ធ"}),e.jsx("input",{className:"form-control",type:"text",ref:h,onkeyup:"this.value = this.value.toLowerCase()",name:"user[username]",id:"user_username"})]}),e.jsxs("p",{children:[e.jsx("label",{for:"user_name",children:"លេខសម្ងាត់"}),e.jsx("input",{className:"form-control",type:"text",name:"user_password",ref:b,id:"user_password"})]}),e.jsxs("p",{children:[e.jsx("label",{for:"user_role",children:"សិទ្ធិប្រើប្រាស់ប្រព័ន្ធ"}),e.jsxs("select",{ref:p,className:"form-control",style:{color:"black",lineHeight:"2"},id:"user_role",children:[e.jsx("option",{value:"",children:"ជ្រើសរើសសិទ្ធិប្រើប្រាស់ប្រព័ន្ធ"}),e.jsx("option",{value:"admin",children:"Admin សាលា"}),e.jsx("option",{value:"is_branch",children:"នាយកសាខា"}),e.jsx("option",{value:"supervisor",children:"ប្រធានផ្នែក"}),e.jsx("option",{value:"assistant",children:"ជំនួយការ"}),e.jsx("option",{value:"is_accountant",children:"គណនេយ្យករ"}),e.jsx("option",{value:"receptionist",children:"អ្នកចុះឈ្មោះសិស្ស"}),e.jsx("option",{value:"is_teacher",children:"គ្រូបង្រៀន"})]})]}),e.jsxs("p",{children:[e.jsxs("div",{className:"dropdown dropup",children:[e.jsx("label",{for:"user_subs",children:"មុខវិជ្ជាបង្រៀន"})," ",e.jsx("br",{}),e.jsx("button",{className:"btn dropdown-toggle",type:"button",id:"dropdownMenuButton4","data-bs-toggle":"dropdown","aria-expanded":"false",children:"ថ្នាក់រៀន"}),e.jsxs("ul",{className:"dropdown-menu menu-lg-scroll","aria-labelledby":"dropdownMenuButton3",id:"subjectList4",children:[U.map((t,s)=>e.jsx("li",{children:e.jsxs("a",{class:"dropdown-item",children:[e.jsx("input",{type:"checkbox",className:"me-2",id:"grade"+t.clEn,value:t.clEn}),e.jsx("label",{for:"subject-math",children:t.clKh}),e.jsx("br",{})]})})),$.map((t,s)=>e.jsx("li",{children:e.jsxs("a",{class:"dropdown-item",children:[e.jsx("input",{type:"checkbox",className:"me-2",id:"grade"+t.clEn,value:t.clEn}),e.jsx("label",{for:"subject-math",children:t.clKh}),e.jsx("br",{})]})})),F.map((t,s)=>e.jsx("li",{children:e.jsxs("a",{class:"dropdown-item",children:[e.jsx("input",{type:"checkbox",className:"me-2",id:"grade"+t.clEn,value:t.clEn}),e.jsx("label",{for:"subject-math",children:t.clKh}),e.jsx("br",{})]})}))]}),e.jsx("button",{className:"btn dropdown-toggle",type:"button",id:"dropdownMenuButton3","data-bs-toggle":"dropdown","aria-expanded":"false",children:"មុខវិជ្ជា"}),e.jsx("ul",{className:"dropdown-menu menu-lg-scroll","aria-labelledby":"dropdownMenuButton3",id:"subjectList3",children:z.map((t,s)=>e.jsx("li",{children:e.jsxs("a",{class:"dropdown-item",children:[e.jsx("input",{type:"checkbox",className:"me-2",id:"subject"+t.subEn,value:t.subAbr}),e.jsx("label",{for:"subject-math",children:t.subKh}),e.jsx("br",{})]})}))}),e.jsx("p",{className:"text-center",children:e.jsx("button",{style:{color:"white"},className:"btn btn-success btn-rounded btn-fw btn-sm",id:"add",children:"ដាក់ចូលគ្នា"})})]}),e.jsx("input",{ref:x,autocomplete:"off",className:"form-control",type:"text",id:"selectedSubjects3"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsxs(A,{ref:C,onClick:le,style:{color:"white"},type:"button",className:"btn btn-success btn-sm",children:[e.jsx(k,{icon:xe}),"   បញ្ចូល"]}),e.jsxs(A,{ref:_,onClick:ne,style:{color:"white"},type:"button",className:"btn btn-warning btn-sm",children:[e.jsx(k,{icon:fe}),"   កែ"]}),e.jsx("button",{ref:M,onClick:ce,style:{color:"white"},id:"btn_upload",type:"button",className:"btn btn-danger btn-sm",children:e.jsx(k,{icon:je})})]})]})})})]})]})})})})};export{Ie as default};
